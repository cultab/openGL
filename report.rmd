---
title: "Εργασία Εξαμήνου"
subtitle: |
    | Πανεπιστήμιο Δυτικής Αττικής
    | Τμήμα Μηχανικών Πληροφορικής και Υπολογιστών
    | \includegraphics{./img/logo.jpg}
    | Εργαστήριο Γραφικών Υπολογιστών
author: Ευάγγελος Κατσανδρής (cs171014@uniwa.gr)
date: "`r Sys.setlocale('LC_TIME', 'el_GR.utf8'); format(Sys.time(), '%d %B, %Y')`"
output: 
    pdf_document:
        template: eisvogel
        highlight: kate
        latex_engine: lualatex
        number_sections: true
        toc: false
        citation_package: biblatex
#bibliography: "bibliography.bib"
lang: "el"
mainfont: 'Liberation Serif'
sansfont: 'Liberation Sans'
#mathfont: 'DejaVu Math TeX Gyre'
monofont: 'Source Code Pro'
fontsize: 11pt
geometry: "margin=2.5cm"
code-block-font-size: \small
table-use-row-colors: true
titlepage: true
titlepage-rule-color: "123c64"
titlepage-rule-height: 10
caption-justification: centering
toc-own-page: false
header-includes:
    \newfontfamily\greekfont{LiberationSerif}
    \newfontfamily\greekfontsf{LiberationSerif}
    \newfontfamily\greekfonttt{LiberationMono}
    \usepackage{float}
    \usepackage{subcaption}
    \usepackage{pgf}
    \usepackage{tikz}
    \usepackage{tikzscale}
    \usepackage{pgfplots}
    \usepackage{chngcntr}
    \counterwithin{figure}{section}
    \pgfplotsset{compat=1.17}
    \usepackage{svg}
    \usepackage{multicol}
    \definecolor{uniwalightblue}{RGB}{103, 173, 224}
    \definecolor{uniwablue}{RGB}{18, 60, 100}
    \definecolor{uniwaorange}{RGB}{230, 124, 23}
    \usepackage{hyperref}
    \hypersetup{
        linkcolor  = black,
        citecolor  = uniwaorange,
        urlcolor   = uniwablue,
        colorlinks = true,
    }
    \urlstyle{same}
---

<!-- \begin{figure}[H] -->
<!-- \centering -->
<!--     \begin{subfigure}[b]{\textwidth} -->
<!--     \centering -->
<!--         \includegraphics[width=\textwidth]{} -->
<!--         \caption{} -->
<!--     \end{subfigure} -->
<!--     \begin{subfigure}[b]{\textwidth} -->
<!--     \centering -->
<!--         \includegraphics[width=\textwidth]{} -->
<!--         \caption{} -->
<!--     \end{subfigure} -->
<!--     \caption{} -->
<!--     \label{} -->
<!-- \end{figure} -->

\newcommand\autonameref[1]{\autoref{#1}, {\nameref{#1}}}

\tableofcontents

\newpage

# Πρόλογος

Η εργασία υλοποιήθηκε από μονομελή ομάδα χρησιμοποιώντας μόνο τις βιβλιοθήκες **webgl-debug.js** και **gl-matrix-min.js**, όπως ζητήθηκε. Η κάθε έκδοση της εργασίας αποτελείτε από δύο αρχεία webgl_X-Y.{js,html} όπου Χ-Υ τα βήματα που περιέχουν --εκτός της τελικής η οποία είναι webgl_final.{js,html}. Ο κώδικας του εργαστηρίου χρησιμοποιήθηκε ως βάση.

^[το παρόν έγγραφο έφτασε τις 4 σελίδες, γιατί τα προβλήματα που αντιμετωπίστηκαν είχαν ενδιαφέρουσες λύσεις]

\begin{figure}[H]
    \centering \includegraphics[width=\textwidth]{"./img/normal.png"}
    \caption{H σκηνή από κοντά με χαμηλό viewDistance}
\end{figure}


# Παραδοχές, Δυσκολίες και Λύσεις

## Συντεταγμένες κορυφών κύβου.

Έπρεπε με συστηματικό τρόπο να βρούμε τις συντεταγμένες που θα δώσουμε σε κάθε κορυφή του κύβου, παίρνοντας υπόψιν ότι
θα επαναλαμβάνουμε τις κορυφές για διαφορετικές έδρες. Έτσι ονοματίστηκαν οι έδρες του κύβου από το 0 μέχρι το 5 
και κάθε κορυφή του κύβου ονοματίστηκε 3 φορές ανάλογα με τις έδρες στις οποίες άνηκε.
Για παράδειγμα η κορυφή που ανήκει στις έδρες 0, 1 και 5 ονομάστηκε 02, 12 και 51.
Έτσι μπορούμε εύκολα να πάρουμε το index της κάθε κορυφής από την εξίσωση
$\mathrm{index}=\mathrm{δεύτερο ψηφίο} + \mathrm{πρώτο ψηφίο} \cdot 4$ για να το χρησιμοποιήσουμε στο indexBuffer.

## drawBox

Εφόσον στα πρώτα βήματα κατασκευάζουμε ένα κύβο στα επόμενα βήματα όπου έχουμε πολλαπλά κουτιά φάνηκε χρήσιμη η εξαγωγή του κώδικα που εμφανίζει τον κύβο σε συνάρτηση. Η συνάρτηση αυτή δέχεται διαφορετικά arguments ανάλογα με την έκδοση της εργασίας αλλά πάντα δέχεται μια θέση (τριάδα αριθμών x,y,z) και μια κλίμακα (τριάδα αριθμών για κλιμάκωση στους άξονες x,y,z).

```js
function drawBox(position, scale);
```

## Χρώμα

Στην έκδοση της εργασίας όπου χρωματίζαμε κάθε έδρα του τραπεζιού και του σκαμνιού/καρέκλας η συνάρτηση drawBox δέχεται ένα χρώμα. 

```js
function drawBox(position, scale, color);
```

**Πρόβλημα 1:** Πως από ένα χρώμα μπορεί να χρωματίζει κάθε έδρα με διαφορετική απόχρωση;

**Λύση 1:** Είναι πολύ απλό (όχι), χρησιμοποιούμε μια συνάρτηση που ονομάζουμε shadeOf() η οποία για ένα χρώμα μας επιστρέφει με τυχαίο τρόπο ένα παρόμοιο χρώμα και την καλούμε για να πάρουμε νέα απόχρωση κάθε 4ο vertex.

**Πρόβλημα 2:** Κάθε φορά που ξανασχεδιάζουμε την σκηνή θα έχουμε ελαφρός διαφορετικά τυχαία χρώματα.

**Λύση 2:** Χρησιμοποιούμε το ίδιο seed στην αρχικοποίηση της γεννήτριας τυχαίων αριθμών μας και την αρχικοποιούμε κάθε φορά στην αρχή της drawScene. *Τι εννοείτε η javascript χρησιμοποιεί **πάντα** την ώρα για seed στην γεννήτρια αριθμών Math.random();*

**Πρόβλημα 3:** η javascript...

**Λύση 3:** Φτιάχνουμε μια δικιά μας γεννήτρια τυχαίων αριθμών η οποία υποστηρίζει αυθαίρετο seed. Χρησιμοποιήθηκε xor shifter βαρέος βασισμένο από [κώδικα αυτής της σελίδας](https://www.udacity.com/blog/2021/04/javascript-random-numbers.html)

Τελικά έτσι μπορούμε να αποφύγουμε να γράψουμε χειροκίνητα $6\cdot10=60$ διαφορετικά χρώματα σε 10 διαφορετικά colorBuffers.

## Textures

**Πρόβλημα:** Στην έκδοση της εργασίας όπου χρησιμοποιούμε υφές η συνάρτηση drawBox() χρειάζεται έναν τρόπο να ξέρει το texture το οποίο θέλουμε να χρησιμοποιήσουμε. Ή ίσως όχι;

**Λύση:** Όχι, η συνάρτηση δεν χρειάζεται να ασχοληθεί με το texture, για αυτό φτιάξαμε μια συνάρτηση που ονομάζουμε useTextureUnitForTexture η οποία δέχεται έναν αριθμό texture unit, και ένα texture. Έτσι μπορούμε να καλούμε την useTextureUnitForTexture μια φορά πριν από κάθε ομάδα drawBox που σχεδιάζει κουτιά που πρέπει να έχουν το ίδιο texture. 

Αυτό έκανε πολύ εύκολο το να χρησιμοποιήσουμε διαφορετικές υφές για τα πόδια του τραπεζιού και της καρέκλας, ακόμα και αν δεν ζητείται.

Επίσης αφαιρέθηκε το χρώμα από την drawBox.

## Easter Egg

Δεν ήταν καθαρό ακριβώς τι έπρεπε να υλοποιήσουμε, άρα αυτό που υλοποιήθηκε είναι:

1. Όταν το animation είναι ενεργοποιημένο, η πλάτη της καρέκλας από το σημείο όπου πρώτα ακουμπάει το πάτωμα
ολισθαίνει και περιστρέφεται μέχρι να φτάσει στην τελική της θέση.

2. Όταν το animation είναι σταματημένο, η πλάτη της καρέκλας να εμφανίζεται ξαφνικά περιστραμένη και ολισθημένη στην τελική της θέση αφού σπάσει.

Και στις δύο περιπτώσεις οι έλεγχοι με το ποντίκι δουλεύουν κανονικά ανεξαρτήτως του animation.

**Πρόβλημα 1:** Για να υλοποιηθεί (με όμορφο τρόπο) η πρώτη περίπτωση η συνάρτηση drawBox έπρεπε με κάποιον τρόπο να υποστηρίζει αυθαίρετη περιστροφή ενός αντικειμένου γύρω από ένα σημείο σε κάποιους άξονες.

```js
function drawBox(position, scale, rotation=0, rotationPoint=[0,0,0], rotationAxis=[0,1,0]);
```

**Λύση 1:** Προσθέτουμε κάποια επιπλέον ορίσματα στην drawBox (με default τιμές), και φτιάχνουμε μια συνάρτηση fromAxisRotationAroundPoint, η οποία για μια γωνία σε rad, ένα σημείο και κάποιους άξονες, μας επιστρέφει μια μήτρα μετασχηματισμού η οποία περιστρέφει ένα αντικείμενο σε κάποιος άξονες γύρω από ένα σημείο. Ο μετασχηματισμός αυτός το επιτυγχάνει μετακινώντας το αντικείμενο στο σημείο γύρω από το οποίο θα περιστραφεί, το περιστρέφει και μετά το μετακινεί στην αρχική του θέση.

**Πρόβλημα 2:** Πως θα ξέρουμε ότι ο χρήστης έχει "χτυπήσει" την καρέκλα πίσω 4 φορές;

**Λύση 2:** Ελέγχουμε εάν η γωνία της περιστροφής της καρέκλας είναι 90 μοίρες κάθε φορά που ο χρήστης παίζει με την ροδέλα, και αν ναι, κάνουμε increment μια μεταβλητή fallBackTimes.

**Πρόβλημα 3:** Χτυπάμε την καρέκλα πίσω μία φορά, συνεχίζουμε και τραβάμε την ροδέλα προς τα πίσω 3 ακόμα φορές, αλλά η καρέκλα δεν κουνιέται γιατί έχουμε βάλει όρια στις γωνίες περιστροφής της. Όμως τώρα η γωνία της καρέκλας ήταν 90 και της τέσσερις φορές που ελέγξαμε άρα σπάει.

**Λύση 3:** Αυξάνουμε την μεταβλητή fallBackTimes μόνο όταν η τιμή της γωνίας έχει αλλάξει από την προηγούμενη φορά που ελένξαμε. Το κάνουμε αυτό με μια bool μεταβλητή mouseWheelChanged.

## Skybox

Πολύ απλά το far του perspective όταν προσδέθηκε το skybox δεν ήταν αρκετό και το viewDistance μπορεί να είναι αυθαίρετα μικρό. Έτσι χρησιμοποιήθηκε σταθερή τιμή (60) για το far.

## Perspective Aspect 

Από κάποιο βήμα και μετά το aspect αντί να είναι 1, υπολογίστηκε από τις διαστάσεις του canvas, εφόσον στην html --για λόγους αισθητικής-- δεν ορίστηκε σταθερό πλάτος. Έτσι για αυθαίρετα μεγέθη του canvas δεν έχουμε παραμόρφωση της σκηνής.

## Z-fighting

Z-fighting εμφανίστηκε μόνο στο πάτωμα όπου εφαρμόστηκε polygon offset όπως είδαμε στο εργαστήριο. Δεν εμφανίστηκε σε άλλα σημεία γιατί υπήρχε ειδική μέριμνα οι έδρες του κουτιών που εφάπτονται να είναι κρυμένες (πχ το κάτω μέρος του τραπεζιού και το πάνω μέρος των ποδιών του).

## Πάχος αντικειμένων

Αρχικά η εργασία είχε παραδωθεί στις 01-07-2021 05:21:07 σύμφωνα με το eclass, αλλά ανήμερα της προθεσμίας 
φάνηκε ότι το πάχος όλων των αντικειμένων ήταν 2 μονάδες αντί για 1, γιατί χρησιμοποιούταν scaling 1 αντι για 0.5.
Έτσι στις 16-7-2021 έπρεπε να αλλάξουν τα scaling σε όλα τα αρχεία τελευταία στιγμή

# Επιπλέον Στιγμιότυπα

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{"./img/ortho-ish.png"}
    \caption{Η σκηνή με χαμηλό fov και ψηλό viewDistance}
\end{figure}

Λόγω του χαμηλού fov η σκηνή φαίνεται *σχεδόν* σαν να είναι από ορθοκανονικό perspective.

\begin{figure}[H]
    \centering
    \includegraphics[width=.5\textwidth]{"./img/z-fight.png"}
    \caption{Το εσωτερικό του τραπεζιού}
\end{figure}

Βλέπουμε το κρυμμένο z-fighting ανάμεσα στο κάτω μέρος του τραπεζιού και το πάνω μέρος ενός ποδιού στο εσωτερικό του
τραπεζιού.
